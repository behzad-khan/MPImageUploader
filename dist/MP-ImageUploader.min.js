/*!
 * MP ImageUploader v1.1.1
 * (c) 2025 Mehrdad Pakniat (مهرداد پاک‌نیت)
 * License: MIT
 * GitHub: https://github.com/behzad-khan/MPImageUploader
 */
(function(){function fileListFromFiles(files){const dt=new DataTransfer;for(const f of files)dt.items.add(f);return dt.files}class MPImageUploader{constructor(selector,options={}){this.selector=selector;this.opt=Object.assign({existingImage:null,lang:"en",texts:null},options);this.defaultTexts={messages:{emptyText:"No image selected",metaText:"Click on the box to choose an image or drop a file here."},buttons:{choose:{label:"Choose Image",aria:"Choose Image"},clear:{label:"Delete Image",aria:"Delete Image"}},image:{previewAlt:"Image preview"}};this._loadLanguage().then(()=>{this._initInputs()})}async _loadLanguage(){if(this.opt.texts){this.texts=this.opt.texts}else{try{const response=await fetch(`../lang/${this.opt.lang}.json`);if(!response.ok)throw new Error("Language file not found");this.texts=await response.json()}catch(err){console.warn("Failed to load language file, using default texts:",err);this.texts=this.defaultTexts}}}_initInputs(){let inputs;if(typeof this.selector==="string")inputs=Array.from(document.querySelectorAll(this.selector));else if(this.selector instanceof HTMLElement)inputs=[this.selector];else inputs=[];inputs.filter(inp=>inp&&inp.type==="file").forEach(inp=>this._enhance(inp))}_enhance(input){input.classList.add("mp-iu-hidden-input");const root=document.createElement("div");root.className="mp-iu-container";const box=document.createElement("div");box.className="mp-iu-box";const empty=document.createElement("div");empty.className="mp-iu-empty";const emptyText=document.createElement("div");emptyText.className="mp-iu-empty-text";emptyText.textContent=this.texts.messages.emptyText;empty.appendChild(emptyText);const img=document.createElement("img");img.className="mp-iu-img";img.alt=this.texts.image.previewAlt;const btnChoose=document.createElement("button");btnChoose.type="button";btnChoose.className="mp-iu-btn mp-iu-btn-choose";btnChoose.title=this.texts.buttons.choose.aria;btnChoose.setAttribute("aria-label",this.texts.buttons.choose.aria);const btnClear=document.createElement("button");btnClear.type="button";btnClear.className="mp-iu-btn mp-iu-btn-clear";btnClear.title=this.texts.buttons.clear.aria;btnClear.setAttribute("aria-label",this.texts.buttons.clear.aria);const meta=document.createElement("div");meta.className="mp-iu-meta";meta.innerHTML=`<span>${this.texts.messages.metaText}</span>`;box.appendChild(empty);box.appendChild(img);box.appendChild(btnChoose);box.appendChild(btnClear);root.appendChild(box);root.appendChild(meta);input.insertAdjacentElement("afterend",root);if(this.opt.existingImage){this._setPreview(img,this.opt.existingImage,root)}box.addEventListener("click",e=>{if(e.target===btnChoose||e.target===btnClear)return;input.click()});input.addEventListener("change",()=>{const file=input.files&&input.files[0];if(!file){if(root.classList.contains("mp-iu-has-image")){this._clear(img,input,root,false)}return}this._readAsDataURL(file).then(dataUrl=>{this._setPreview(img,dataUrl,root)})});btnChoose.addEventListener("click",()=>input.click());btnClear.addEventListener("click",()=>this._clear(img,input,root));box.addEventListener("dragover",e=>{e.preventDefault();root.classList.add("mp-iu-dragover")});box.addEventListener("dragleave",e=>{e.preventDefault();root.classList.remove("mp-iu-dragover")});box.addEventListener("drop",e=>{e.preventDefault();root.classList.remove("mp-iu-dragover");if(!e.dataTransfer.files||!e.dataTransfer.files.length)return;input.files=fileListFromFiles(e.dataTransfer.files);input.dispatchEvent(new Event("change",{bubbles:true}))})}_readAsDataURL(file){return new Promise((resolve,reject)=>{const reader=new FileReader;reader.onload=e=>resolve(e.target.result);reader.onerror=e=>reject(e);reader.readAsDataURL(file)})}_setPreview(img,src,root){img.src=src;root.classList.add("mp-iu-has-image")}_clear(img,input,root,triggerChange=true){img.src="";root.classList.remove("mp-iu-has-image");input.value="";if(triggerChange){input.dispatchEvent(new Event("change",{bubbles:true}))}}}window.MPImageUploader=MPImageUploader;console.log("%cMP ImageUploader v1.0.0 - Developed by Mehrdad Pakniat","color: #1e90ff; font-weight: bold;")})();